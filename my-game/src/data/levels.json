{
  "meta": {
    "gameId": "school-day-journey",
    "version": "1.0.0",
    "totalHearts": 3,
    "shuffleWithinTier": true,
    "tiers": {
      "1": "Getting Ready",
      "2": "Bus Ride",
      "3": "School Entrance"
    }
  },
  "levels": [
    {
      "id": "lvl_backpack",
      "tier": 1,
      "type": "drag-drop-sort",
      "title": "Pack your Backpack",
      "instruction": "Drag the correct items into the backpack.",
      "config": {
        "background": "/game/backgrounds/backpack_room.png",
        "character": {
          "happy": "/game/characters/Lina/pajamas/happy.png",
          "sad": "/game/characters/Lina/pajamas/sad.png",
          "default": "/game/characters/Lina/pajamas/base.png"
        },
        "backpack": {
          "image": "/game/items/backpack.png",
          "dropZoneId": "bag_zone",
          "scale": 1.0,
          "position": { "x": 50, "y": 80 } 
        },
        "checklist": {
          "title": "Checklist",
          "requirements": [
            { "id": "req_stationery", "label": "Stationery", "minCorrect": 3 },
            { "id": "req_snack", "label": "Snack", "minCorrect": 1 },
            { "id": "req_hygiene", "label": "Hygiene", "minCorrect": 1 }
          ]
        },
        "items": [
          {
            "id": "it_gamepad",
            "name": "Gamepad",
            "category": "junk",
            "isCorrect": false,
            "image": "/game/items/gamepad.png",
            "x": 20,
            "y": 60
          },
          {
            "id": "it_napkins",
            "name": "Napkins",
            "category": "hygiene",
            "isCorrect": true,
            "image": "/game/items/napkins.png",
            "x": 30,
            "y": 60
          },
          {
            "id": "it_toy",
            "name": "Toy Bear",
            "category": "junk",
            "isCorrect": true,
            "image": "/game/items/toy.png",
            "message": "You are too old for this!",
            "x": 5,
            "y": 80
          },
          {
            "id": "it_jumprope",
            "name": "Jump Rope",
            "category": "junk",
            "isCorrect": false,
            "image": "/game/items/jumprope.png",
            "x": 28,
            "y": 92
          },
          {
            "id": "it_pen",
            "name": "Pen",
            "category": "stationery",
            "isCorrect": true,
            "image": "/game/items/pen.png",
            "x": 50,
            "y": 49
          },
          {
            "id": "it_notebook",
            "name": "Notebook",
            "category": "stationery",
            "isCorrect": true,
            "image": "/game/items/notebook.png",
            "x": 60,
            "y": 62
          },
          {
            "id": "it_pencil",
            "name": "Pencil",
            "category": "stationery",
            "isCorrect": true,
            "image": "/game/items/pencil.png",
            "x": 70,
            "y": 50
          },
          {
            "id": "it_apple",
            "name": "Apple",
            "category": "snack",
            "isCorrect": true,
            "image": "/game/items/apple.png",
            "x": 65,
            "y": 85
          },
          {
            "id": "it_wrench",
            "name": "Wrench",
            "category": "junk",
            "isCorrect": false,
            "image": "/game/items/wrench.png",
            "x": 92,
            "y": 95
          }
        ],
        "rules": {
          "mistakePenaltyHearts": 1,
          "maxMistakesBeforeFail": 2,
          "successGlow": true,
          "failGlow": true
        },
        "sounds": {
          "success": "/game/sfx/success.wav",
          "fail": "/game/sfx/fail.wav",
          "drop": "/game/sfx/drop.wav",
          "clap": "/game/sfx/clap.wav",
          "joy": "/game/sfx/joy.wav"
        }
      }
    },
    {
      "id": "lvl_breakfast",
      "tier": 1,
      "type": "cooking",
      "title": "Make Breakfast",
      "instruction": "Follow the steps in order. First, slice the food.",
      "config": {
        "background": "/game/backgrounds/kitchen.png",

        "ui": {
          "showStepPopupAtStart": true,
          "stepPopup": {
            "title": "Lina",
            "lines": [
              "Let's see what we have in the kitchen.",
              "Follow the sequence. First, slice the food."
            ]
          },
          "retryPopup": {
            "title": "Try again",
            "text": "You made a mistake. You have a couple of tries, watch the hearts."
          }
        },

        "stations": {
          "fridgeZoneId": "fridge_zone",
          "boardZoneId": "board_zone",
          "plateZoneId": "plate_zone"
        },

        "layout": {
          "actors": [],
          "zones": {
            "fridge_zone": { "x": 165, "y": 10, "w": 240, "h": 580 },
            "board_zone":  { "x": 260, "y": 590, "w": 620, "h": 420 },
            "plate_zone":  { "x": 940, "y": 590, "w": 620, "h": 420 }
          },

          "fridgeSlots": {
            "ing_tomato_whole": { "x": 60,  "y": 152, "w": 150, "h": 150 },
            "ing_bun_bottom":   { "x": 170, "y": 152, "w": 160, "h": 160 },
            "ing_cheese":       { "x": 60,  "y": 282, "w": 150, "h": 150 },
            "ing_bun_top":      { "x": 170, "y": 282, "w": 160, "h": 160 },

            "ing_tomato_slice": { "x": 115, "y": 422, "w": 150, "h": 150 }
          },

          "boardSlots": {
            "ing_tomato_whole": { "x": 430, "y": 720, "w": 180, "h": 180 },
            "ing_tomato_slice": { "x": 430, "y": 720, "w": 180, "h": 180 },

            "ing_bun_bottom":   { "x": 590, "y": 720, "w": 220, "h": 220 },
            "ing_cheese":       { "x": 780, "y": 740, "w": 200, "h": 200 },
            "ing_bun_top":      { "x": 980, "y": 720, "w": 220, "h": 220 }
          },

          "plateSlots": {
            "ing_bun_bottom":   { "x": 1120, "y": 750, "w": 280, "h": 280, "z": 21 },
            "ing_cheese":       { "x": 1120, "y": 740, "w": 250, "h": 250, "z": 22 },
            "ing_tomato_slice": { "x": 1130, "y": 730, "w": 230, "h": 230, "z": 23 },
            "ing_bun_top":      { "x": 1120, "y": 700, "w": 290, "h": 290, "z": 24 }
          }
        },

        "recipe": {
          "title": "Sandwich",
          "strictOrder": true,
          "steps": [
            { "id": "step_drag_tomato_to_board", "action": "drag", "itemId": "ing_tomato_whole", "from": "fridge_zone", "to": "board_zone", "text": "Put the whole tomato on the board." },
            { "id": "step_cut_tomato", "action": "tap", "itemId": "ing_tomato_whole", "on": "board_zone", "tapsRequired": 15, "tapSound": "cut", "text": "Tap the tomato 15 times to slice it." },

            { "id": "step_drag_bun_bottom_to_board", "action": "drag", "itemId": "ing_bun_bottom", "from": "fridge_zone", "to": "board_zone", "text": "Put the bottom bun on the board." },
            { "id": "step_drag_cheese_to_board",     "action": "drag", "itemId": "ing_cheese",     "from": "fridge_zone", "to": "board_zone", "text": "Put the cheese on the board." },
            { "id": "step_drag_bun_top_to_board",    "action": "drag", "itemId": "ing_bun_top",    "from": "fridge_zone", "to": "board_zone", "text": "Put the top bun on the board." },

            { "id": "step_drag_bun_bottom_to_plate", "action": "drag", "itemId": "ing_bun_bottom",   "from": "board_zone", "to": "plate_zone", "text": "Move the bottom bun to the plate." },
            { "id": "step_drag_cheese_to_plate",     "action": "drag", "itemId": "ing_cheese",       "from": "board_zone", "to": "plate_zone", "text": "Move the cheese to the plate." },
            { "id": "step_drag_slice_to_plate",      "action": "drag", "itemId": "ing_tomato_slice", "from": "board_zone", "to": "plate_zone", "text": "Move the sliced tomato to the plate." },
            { "id": "step_drag_bun_top_to_plate",    "action": "drag", "itemId": "ing_bun_top",      "from": "board_zone", "to": "plate_zone", "text": "Move the top bun to the plate to finish." }
          ]
        },

        "ingredients": [
          {
            "id": "ing_tomato_whole",
            "name": "Tomato (whole)",
            "image": "/game/items/tomato_whole.png",
            "initialZone": "fridge_zone",
            "transformOnCompleteStepId": "step_cut_tomato",
            "transformTo": { "hideSelf": true, "showIngredientId": "ing_tomato_slice" }
          },
          {
            "id": "ing_tomato_slice",
            "name": "Tomato (sliced)",
            "image": "/game/items/tomato_slice.png",
            "initialZone": "fridge_zone",
            "initiallyVisible": false
          },
          { "id": "ing_bun_bottom", "name": "Bottom bun", "image": "/game/items/bun_bottom.png", "initialZone": "fridge_zone" },
          { "id": "ing_cheese",     "name": "Cheese",     "image": "/game/items/cheese.png",     "initialZone": "fridge_zone" },
          { "id": "ing_bun_top",    "name": "Top bun",    "image": "/game/items/bun_top.png",    "initialZone": "fridge_zone" }
        ],

        "checklist": { "title": "Steps", "bindToRecipeSteps": true, "strikeCompleted": true },

        "rules": { "mistakePenaltyHearts": 1, "maxMistakesBeforeFail": 2, "restartOnFail": true },

        "sounds": {
          "success": "/game/sfx/success.wav",
          "fail": "/game/sfx/fail.wav",
          "drop": "/game/sfx/drop.wav",
          "cut": "/game/sfx/cut.wav",
          "joy": "/game/sfx/joy.wav",
          "clap": "/game/sfx/clap.wav"
        }
      }
    },
    {
      "id": "lvl_dress_up",
      "tier": 1,
      "type": "dress-up-iron",
      "title": "Get Dressed",
      "instruction": "Choose the right outfit and iron it.",
      "config": {
        "backgrounds": {
          "closed": "/game/backgrounds/wardrobeclosed.png",
          "opened": "/game/backgrounds/wardrobeopened.png",
          "empty": "/game/backgrounds/wardrobeempty.png"
        },
        "character": {
          "pajamas": "/game/characters/Lina/pajamas/base.png",
          "happy": "/game/characters/Lina/suit/happy.png"
        },
        "dialogs": {
          "intro": "Hmm... I need to get dressed. Mom told me to pick the right uniform.",
          "closed": "Let's see what I have inside.",
          "opened": "Tap on the wardrobe to take out clothes.",
          "choice": "Choose wisely!",
          "ironing": "It looks wrinkled! Iron it out with your finger."
        },
        "outfits": [
          {
            "id": "outfit_dirty",
            "name": "Dirty Clothes",
            "image": "/game/items/dirty_dress.png",
            "isCorrect": false,
            "failMessage": "It's dirty! I can't go to school like this."
          },
          {
            "id": "outfit_school",
            "name": "School Uniform",
            "image": "/game/items/school_suit.png",
            "isCorrect": true,
            "fabricTexture": "/game/items/fabric.png"
          },
          {
            "id": "outfit_sport",
            "name": "Sport Suit",
            "image": "/game/items/sport_suit.png",
            "isCorrect": false,
            "failMessage": "This is for gym class, not for the first day!"
          }
        ],
        "ironing": {
          "brushSize": 40,
          "requiredCoverage": 0.85
        },
        "sounds": {
            "success": "/game/sfx/success.wav",
            "fail": "/game/sfx/fail.wav"
        }
      }
    },
    {
      "id": "lvl_maze_house_to_bus",
      "tier": 1,
      "type": "maze",
      "title": "Get to the Bus",
      "ui": {
        "introText": "Help Lina find the way to the bus!",
        "introButton": "Got it!"
      },
      "instruction": "Find the way from home to the bus.",
      "config": {
        "background": "/game/backgrounds/maze_scene.png",
        "mazeImage": "/game/backgrounds/maze_overlay.jpg",
        "player": {
          "image": "/game/characters/Lina/suit/maze.png",
          "scale": 11
        },
        "maze": {
          "fromImage": "/game/backgrounds/maze_overlay.jpg",
          "imageGrid": { "w": 140, "h": 140 },
          "threshold": 200,
          "invert": false,
          "cellSize": 8,
          "start": { "x": 7, "y": 25 },
          "finish": { "x": 134, "y": 124 }
        },
        "controls": {
          "desktop": "arrows",
          "mobile": "onScreenArrows"
        },
        "rules": {
          "timeLimitSec": 0
        }
      }
    },

    {
      "id": "lvl_fix_wires",
      "tier": 2,
      "type": "wires-connect",
      "description": "Fix the Wires on the Bus",
      "config": {
        "background": "/game/backgrounds/wires.png",
        "leftTerminals": [
          { "id": "l_yellow", "color": "yellow", "x": 0.12, "y": 0.22 },
          { "id": "l_red",    "color": "red",    "x": 0.12, "y": 0.52 },
          { "id": "l_blue",   "color": "blue",   "x": 0.12, "y": 0.80 }
        ],
        "rightTerminals": [
          { "id": "r_red",    "color": "red",    "x": 0.88, "y": 0.22 },
          { "id": "r_blue",   "color": "blue",   "x": 0.88, "y": 0.58 },
          { "id": "r_yellow", "color": "yellow", "x": 0.88, "y": 0.83 }
        ],

        "rules": {
          "allowCrossing": true,
          "mistakePenaltyHearts": 1,
          "maxMistakesBeforeFail": 2
        },
        "sounds": {
          "connect": "sfx/connect.wav",
          "fail": "sfx/fail.wav",
          "success": "sfx/success.wav",
          "cut": "/game/sfx/cut.wav"
        }
      }
    },
    {
      "id": "lvl_pay_fare",
      "tier": 2,
      "type": "pin-memory",
      "description": "Pay the Fare",
      "config": {
        "background": "bg_bus_terminal.png",
        "rounds": 3,
        "pin": {
          "length": 4,
          "showDurationMs": 2200,
          "hideDelayMs": 400
        },
        "phoneMessage": {
          "from": "Mom",
          "bubbleImage": "ui/phone_bubble.png",
          "position": "right"
        },
        "keypad": {
          "layout": "default",
          "sound": "sfx/keypad.wav"
        },
        "rules": {
          "mistakePenaltyHearts": 1,
          "maxMistakesBeforeFail": 2,
          "regeneratePinEachRound": true
        },
        "sounds": {
          "success": "sfx/success.wav",
          "fail": "sfx/fail.wav"
        }
      }
    },
    {
      "id": "tr_cross_road",
      "tier": 2,
      "type": "traffic-light",
      "description": "Cross the Road",
      "config": {
        "background": "bg_crosswalk.png",
        "lights": [
          { "state": "red", "durationMs": 2200 },
          { "state": "yellow", "durationMs": 900 },
          { "state": "green", "durationMs": 1600 }
        ],
        "button": {
          "label": "GO",
          "image": "ui/go_button.png"
        },
        "rules": {
          "pressOnGreenOnly": true,
          "pressOnRed": "gameover",
          "pressOnYellow": "warning",
          "warningText": "Wait!"
        },
        "visuals": {
          "gameoverImage": "fx/car_hit.png",
          "warningFlash": true
        },
        "sounds": {
          "warning": "sfx/warn.wav",
          "gameover": "sfx/gameover.wav",
          "success": "sfx/success.wav"
        }
      }
    },
    {
      "id": "lvl_memory_pairs",
      "tier": 3,
      "type": "memory-pairs",
      "description": "Defeat the Classmate: Find the Pairs",
      "config": {
        "background": "bg_school_entrance.png",
        "npc": {
          "name": "Classmate",
          "image": "npc/classmate.png",
          "dialogue": [
            "Don't know where to go?",
            "Okay, let's play. Find the pairs and I'll show you the classroom."
          ]
        },
        "board": {
          "cols": 4,
          "rows": 3,
          "cardBack": "cards/back.png",
          "pairs": [
            { "id": "p1", "front": "cards/pencil.png" },
            { "id": "p2", "front": "cards/bus.png" },
            { "id": "p3", "front": "cards/apple.png" },
            { "id": "p4", "front": "cards/book.png" },
            { "id": "p5", "front": "cards/star.png" },
            { "id": "p6", "front": "cards/heart.png" }
          ]
        },
        "rules": {
          "timeLimitSec": 50,
          "mistakePenaltyHearts": 1,
          "maxMistakesBeforeFail": 3,
          "shuffleCards": true
        },
        "sounds": {
          "flip": "sfx/flip.wav",
          "match": "sfx/match.wav",
          "fail": "sfx/fail.wav",
          "success": "sfx/success.wav"
        },
        "endings": {
          "successTransition": { "type": "gif", "asset": "transitions/arrive_classroom.gif" }
        }
      }
    }
  ],
  "endScreens": {
    "gameOver": {
      "title": "Game Over",
      "subtitle": "You ran out of hearts. Life does that sometimes.",
      "image": "ui/game_over.png"
    },
    "victory": {
      "title": "Hooray, you made it to the classroom!",
      "subtitle": "Statistics below. Printing is allowed by human laws.",
      "image": "ui/victory.png",
      "stats": {
        "showTotalTime": true,
        "showLevelSequence": true,
        "showMistakes": true,
        "showHeartsLeft": true,
        "showComparisonToPrevious": true,
        "printEnabled": true,
        "storageKey": "sdj_best_run"
      },
      "menu": [
        { "id": "play_again", "label": "Play Again" },
        { "id": "close_game", "label": "Close Game" },
        { "id": "save_score", "label": "Save Score for Next Time" }
      ]
    }
  }
}
